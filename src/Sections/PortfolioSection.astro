---
// src/Sections/PortfolioSection.astro
import { Image, getImage } from "astro:assets";
import PortfolioCarousel from "../components/Carousels/PortfolioCarousel.jsx";
import BorderTitle from "../components/BorderTitle.jsx";
import Heading from "../components/Heading.jsx";

// Import images using Astro's assets
import ProntoDesktop from "../assets/ProntoJunkRemoval/pronto-desktop.jpg";
import FariasDesktop from "../assets/FariasDemolition/Farias-Desktop.jpg";
import JSVDesktop from "../assets/JSV-Quick-Solar/JSV-Desktop.jpg";
import PablosDesktop from "../assets/PablosPeakRoofing/Pablos-Desktop.jpg";
import RoonysDesktop from "../assets/RoonysMarketing/Roonys-Desktop.jpg";
import CleanomaticFl from "../assets/Cleanomatic/cleanomaticfl.com-desktop.jpg";

// Define items with image metadata
const items = [
  {
    id: 1,
    title: "Pronto Junk Removal",
    image: ProntoDesktop,
    alt: "Pronto Junk Removal website screenshot",
  },
  {
    id: 3,
    title: "Roonys Marketing",
    image: RoonysDesktop,
    alt: "Roonys Marketing website screenshot",
  },
  {
    id: 4,
    title: "Faria's Demolition",
    image: FariasDesktop,
    alt: "Faria's Demolition website screenshot",
  },
  {
    id: 5,
    title: "Cleanomatic Fl LLC",
    image: CleanomaticFl,
    alt: "Cleanomatic FL website screenshot",
  },
  {
    id: 6,
    title: "Pablo's Peak Roofing",
    image: PablosDesktop,
    alt: "Pablo's Peak Roofing website screenshot",
  },
  {
    id: 7,
    title: "JSV Quick Solar",
    image: JSVDesktop,
    alt: "JSV Quick Solar website screenshot",
  },
];

// Process images - keep original aspect ratios for scrollable screenshots
const processedItems = await Promise.all(
  items.map(async (item) => {
    // Don't crop the images - preserve full height for scrolling
    // Just optimize them at different widths
    const centerImage = await getImage({
      src: item.image,
      width: 860,
      format: 'webp',
      quality: 85,
    });
    
    const sideImage = await getImage({
      src: item.image,
      width: 520,
      format: 'webp',
      quality: 80,
    });
    
    const mobileImage = await getImage({
      src: item.image,
      width: 340,
      format: 'webp',
      quality: 80,
    });

    return {
      id: item.id,
      title: item.title,
      alt: item.alt,
      image: centerImage.src,
      imageSources: {
        center: centerImage.src,
        side: sideImage.src,
        mobile: mobileImage.src,
      },
      // Pass original dimensions for aspect ratio
      dimensions: {
        width: centerImage.options.width,
        height: centerImage.options.height,
      }
    };
  })
);
---

<section
  id="projects"
  data-portfolio-section
  class="w-screen overflow-x-hidden outer-section bg-bg relative"
>
  <div class="section-color-border"></div>

  <div class="">
    <header class="text-section">
      <BorderTitle client:visible>Our Projects</BorderTitle>
      <Heading
        tagName="h2"
        className="mb-6"
        before="Our "
        text="Portfolio"
        textClass="emphasized-text"
        client:visible
      />
      <p class="large-text mx-auto">
        Discover the websites we've crafted for businesses across different
        industries
      </p>
    </header>

    <PortfolioCarousel
      items={processedItems}
      autoAdvanceDelay={6000}
      autoplay
      client:visible
    />
  </div>
</section>